name: Secret Scanning

on:
	push:
		branches: [ main ]
	pull_request:
		types: [opened, synchronize, reopened]

jobs:
	gitleaks-scan:
		name: Run gitleaks secret scan
		runs-on: ubuntu-latest
		steps:
			- name: Checkout repository
				uses: actions/checkout@v4

					- id: scan
						name: Run gitleaks
						uses: zricethezav/gitleaks-action@v2
						with:
							args: --path=. --redact --report-format=json --report-path=gitleaks-report.json

			- name: Upload gitleaks report
				if: always()
				uses: actions/upload-artifact@v4
				with:
					name: gitleaks-report
					path: gitleaks-report.json

					- name: Fail on secrets found
						if: steps.scan.conclusion == 'failure'
						run: |
							echo "Secrets found by gitleaks. See gitleaks-report.json for details."
							exit 1

